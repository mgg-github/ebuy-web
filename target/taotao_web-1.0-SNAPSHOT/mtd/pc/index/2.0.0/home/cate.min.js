define("home/widget/cate", function (require) {
    "use strict";
    var t = require("conf"), e = require("load_async"), a = _.Class.extend({
        statics: {NO_HTTPS_DOMAIN_REG: /^\/\/(car\.jd\.com|group\.jd\.com|huishou\.jd\.com|dujia\.jd\.com)/},
        construct: function (t) {
            this.conf = $.extend({$el: null}, t), this.init()
        },
        init: function () {
            var e = this.conf, a = e.$el.attr("data-type"), i = pageConfig.leftCateABtestSwitch, n = t.INTERFACE;
            e.type = a ? a : "home", e.isSubDataLoaded = !1, e.isPopMenuBinded = !1, e.dataUrl = n.CATE_A, e.dataBackupUrl = n.CATE_A_BACKUP_PC, e.scriptCharset = "gb2312";
            var l = pageConfig.user.jda, s = !0;
            if (i && "string" == typeof l) {
                var c = pageConfig.leftCateABtestSection || {start: 1e3, end: 2e3}, o = pageConfig.user.unifiedHash;
                o > c.start && o <= c.end && (s = !1)
            }
            "boolean" == typeof pageConfig.isCateUseA ? pageConfig.isCateUseA || (e.dataUrl = n.CATE_B, e.dataBackupUrl = n.CATE_B_BACKUP_PC, e.scriptCharset = "utf-8") : s || (e.dataUrl = n.CATE_B, e.dataBackupUrl = n.CATE_B_BACKUP_PC, e.scriptCharset = "utf-8"), pageConfig.leftCateABtestUseA = s, e.imgIndex = 0, this.$popCtn = $(".JS_popCtn", this.conf.$el), this.loaded = !1, this.initEvent()
        },
        initEvent: function () {
            var t = this, e = this.conf.$el, a = null, i = null, n = null, l = !1;
            e.bind("mouseenter", function () {
                i && clearTimeout(i), i = setTimeout(function () {
                    l || (l = !0, t.initSubCate())
                }, 200)
            }).one("mousemove", function () {
                n && clearTimeout(n), n = setTimeout(function () {
                    l || (l = !0, t.initSubCate())
                }, 200)
            }).one("mouseleave", function () {
                e.find(".cate_menu_item").removeClass("hover")
            }).delegate(".cate_menu_item", "mouseenter", function (e) {
                a && clearTimeout(a), a = setTimeout(function () {
                    t.conf.isPopMenuBinded || (t._hoverel = $(e.currentTarget), t.$popCtn.show())
                }, 200)
            }).bind("mouseleave", function () {
                a && clearTimeout(a), i && clearTimeout(i), t.conf.isPopMenuBinded || t.$popCtn.hide()
            })
        },
        initSubCate: function () {
            var t = this, e = t.conf.$el;
            t.conf.isSubDataLoaded || t.getSubCateData(this.conf.type, function () {
                var a = $("#J_popCtn");
                $(".cate_part", a);
                require.async("O2_COMPONENT/sidePopMenu/1.0.0/sidePopMenu.js", function (i) {
                    new i({
                        $container: e,
                        navItemHook: ".cate_menu_item",
                        navItemOn: "cate_menu_item_on",
                        popItemHook: ".cate_part",
                        itemEnterCallBack: function (t) {
                            var i = $(window).scrollTop(), n = e.offset().top, l = 0;
                            i > n && (l = i - n), a.css({top: l}), _.eventCenter.trigger("lazyload:DOMUpdate", t.$displayEl)
                        }
                    });
                    t.$popCtn.is(":hidden") || t._hoverel.trigger("mouseenter.itemEnter"), t.conf.isPopMenuBinded = !0
                })
            })
        },
        getSubCateData: function (a, i) {
            var n = this.conf;
            e({
                url: n.dataUrl,
                scriptCharset: n.scriptCharset,
                cache: !0,
                jsonpCallback: "getCategoryCallback",
                backup: n.dataBackupUrl,
                timeout: t.TIMEOUT,
                dataCheck: function (t) {
                    return !!(t && t.data && t.data.length)
                }
            }).then($.proxy(function (t) {
                this.render(t), this.conf.isSubDataLoaded = !0, i && i()
            }, this))
        },
        padding: function (t) {
            return (t < 9 ? "0" : "") + (1 + t)
        },
        render: function (t) {
            var e, a, i, n, l, s, c, o, d, r, u, g, m, f, p, h, _, C, v, k, b = this, x = t.data, T = b.padding, y = "",
                A = function (t, e, a, i) {
                    return "h|keycount|2016|06" + Array.prototype.slice.call(arguments).join("")
                }, $ = x.length;
            for (e = 0; e < $; e++) {
                a = x[e], C = '<div class="cate_part_col1">';
                f="";
                // for (f = "", n = a.s.length, i = 0; i < n; i++)
                    for (l = a, c = l.s.length, s = 0; s < c; s++) {
                    if (o = l.s[s].s, u = b.getLinkHtml({
                            str: l.s[s].n,
                            linkClass: "cate_detail_tit_lk",
                            imagesWidth: null,
                            imagesHeight: null,
                            level: 2,
                            textPrefix: null,
                            textSuffix: '<i class="iconfont cate_detail_tit_arrow">&#xe601;</i>'
                        }),
                            m = '<dt class="cate_detail_tit" clstag="' + A(T(e), "c", T(s)) + '">' + u + "</dt>", g = "", 0 != o)
                        for (r = o.length, d = 0; d < r; d++)g += b.getLinkHtml({
                        str: o[d].n,
                        linkClass: "cate_detail_con_lk",
                        imagesWidth: null,
                        imagesHeight: 16,
                        level: 3,
                        textPrefix: null,
                        textSuffix: null,
                        index: d
                    });
                    g = '<dd class="cate_detail_con" clstag="' + A(T(e), "d", T(s)) + '">' + g + "</dd>", f += '<dl class="cate_detail_item cate_detail_item' + (s + 1) + '">' + m + g + "</dl>"
                }
                f = '<div class="cate_detail">' + f + "</div>", C += f + "</div>", h = "", _ = 0;
                y += '<div class="cate_part clearfix" id="cate_item' + (e + 1)  + '">' + C  + "</div>"
            }
            this.$popCtn.html(y).removeClass("mod_loading")
        },
        getLinkHtml: function (t) {
            var e = t.str, i = t.linkClass, n = t.imagesWidth, l = t.imagesHeight, s = t.level, c = t.textPrefix,
                o = t.textSuffix, d = t.index, r = t.clstag ? ' clstag="' + t.clstag + '"' : "", u = e.split("|"),
                g = [], m = "";
            u[0] = u[0].replace(/ /g, "");
            var f = /^\d.*\d$/.test(u[0]) ? u[0] : u[0].replace(/^(http\:\/\/|\/\/)/, "");
            "undefined" != typeof s && /^\d.*\d$/.test(u[0]) && (2 === s ? f = "channel.taotao.com/" + u[0] + ".html" : 3 === s && (2 === u[0].split("-").length ? f = "channel.taotao.com/" + u[0] + ".html" : 3 === u[0].split("-").length && (f = "list.taotao.com/list.html?cat=" + u[0].replace(/\-/g, ",")))), f = "//" + f, "https:" === location.protocol && a.NO_HTTPS_DOMAIN_REG.test(f) && (f = "http:" + f), u[2], i && g.push(i), g.length > 0 && (m = 'class="' + g.join(" ") + '"');
            var p = "";
            return p = u[0] ? '<a href="' + f + '" ' + m + r + ' target="_blank">' : "<span " + m.replace(/lk/, "txt") + ">", u[2] ? (this.conf.imgIndex > 4 && (this.conf.imgIndex = 0), n = n ? ' width="' + n + '"' : "", l = l ? ' height="' + l + '"' : "", p += '<img data-lazy-img="//img1' + this.conf.imgIndex + ".360buyimg.com/" + u[2] + '"  ' + n + l + ' src="//taotao.com/mtd/pc/common/img/blank.png" data-webp="no"/>', this.conf.imgIndex += 1) : p += (c || "") + u[1] + (o || ""), p += u[0] ? "</a>" : "</span>", 3 === s && 0 === d && 1 === parseInt(u[3], 10) && u[0] && (g.push(i + "_hot"), m = 'class="' + g.join(" ") + '"', p = '<a href="' + f + '" ' + m + ' target="_blank"><i class="cate_con_hot_l"></i>' + (c || "") + u[1] + (o || "") + '<i class="cate_con_hot_r"></i></a>'), p
        }
    });
    return a
});
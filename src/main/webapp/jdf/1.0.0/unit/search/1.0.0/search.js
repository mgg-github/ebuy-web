/* jdf-1.0.0/ search.js Date:2017-05-23 20:25:30 */
window.searchlog=window.searchlog||function(){var a="//sstat."+pageConfig.FN_getDomain()+"/scslog?args=";var b="{keyword}^#psort#^#page#^#cid#^"+encodeURIComponent(document.referrer);var c="2";var d="";var e="";var f=function(){var f="";var g="";var h="";var i="0";if(arguments.length>0)if(0==arguments[0])f=a+c+"^"+b+"^^^58^^"+e+"^"+d;else if(1==arguments[0]){f=10!=c?a+"1^"+b+"^":a+"11^"+b+"^";for(var j=1;j<arguments.length;j++)f+=encodeURI(arguments[j])+"^";arguments.length>3&&"51"==arguments[3]&&(g=arguments[1]),arguments.length>3&&"55"==arguments[3]&&(h=arguments[1]),arguments.length>3&&"56"==arguments[3]&&(i=arguments[1]);for(var j=0,k=5-arguments.length;k>j;j++)f+="^";f+=e+"^"+d}f=f.replace("#cid#",g),f=f.replace("#psort#",h),f=f.replace("#page#",i),$.getScript(f);try{JA.tracker.ngloader("search.000006",{url:window.location.href})}catch(l){}};return f}();function search(a){var b,c="//search.taotao.com/Search?keyword={keyword}&enc={enc}{additional}";var d=search.additinal||"";var e=document.getElementById(a);var f=e.value;if(f=f.replace(/^\s*(.*?)\s*$/,"$1"),f.length>100&&(f=f.substring(0,100)),""==f)return void(window.location.href=window.location.href);var g=0;"undefined"!=typeof window.pageConfig&&"undefined"!=typeof window.pageConfig.searchType&&(g=window.pageConfig.searchType);var h="&cid{level}={cid}";var i="string"==typeof search.cid?search.cid:"";var j="string"==typeof search.cLevel?search.cLevel:"";var k="string"==typeof search.ev_val?search.ev_val:"";switch(g){case 0:break;case 1:j="-1",d+="&book=y";break;case 2:j="-1",d+="&mvd=music";break;case 3:j="-1",d+="&mvd=movie";break;case 4:j="-1",d+="&mvd=education";break;case 5:var l="&other_filters=%3Bcid1%2CL{cid1}M{cid1}[cid2]";switch(j){case"51":h=l.replace(/\[cid2]/,""),h=h.replace(/\{cid1}/g,"5272");break;case"52":h=l.replace(/\{cid1}/g,"5272"),h=h.replace(/\[cid2]/,"%3Bcid2%2CL{cid}M{cid}");break;case"61":h=l.replace(/\[cid2]/,""),h=h.replace(/\{cid1}/g,"5273");break;case"62":h=l.replace(/\{cid1}/g,"5273"),h=h.replace(/\[cid2]/,"%3Bcid2%2CL{cid}M{cid}");break;case"71":h=l.replace(/\[cid2]/,""),h=h.replace(/\{cid1}/g,"5274");break;case"72":h=l.replace(/\{cid1}/g,"5274"),h=h.replace(/\[cid2]/,"%3Bcid2%2CL{cid}M{cid}");break;case"81":h=l.replace(/\[cid2]/,""),h=h.replace(/\{cid1}/g,"5275");break;case"82":h=l.replace(/\{cid1}/g,"5275"),h=h.replace(/\[cid2]/,"%3Bcid2%2CL{cid}M{cid}")}c="//search-e.taotao.com/searchDigitalBook?ajaxSearch=0&enc=utf-8&key={keyword}&page=1{additional}";break;case 6:j="-1",c="//music.taotao.com/8_0_desc_0_0_1_15.html?key={keyword}";break;case 7:c="//s-e.taotao.com/Search?key={keyword}&enc=utf-8";break;case 8:c="//search.jd.hk/Search?keyword={keyword}&enc=utf-8";break;case 9:d+="&market=1"}if("string"==typeof i&&""!=i&&"string"==typeof j){var m=/^(?:[1-8])?([1-3])$/;j="-1"==j?"":m.test(j)?RegExp.$1:"";var n=h.replace(/\{level}/,j);n=n.replace(/\{cid}/g,i),d+=n}if("string"==typeof k&&""!=k&&(d+="&ev="+k),f=encodeURIComponent(f),b=c.replace(/\{keyword}/,f),b=b.replace(/\{enc}/,"utf-8"),b=b.replace(/\{additional}/,d),"object"==typeof $o&&("string"==typeof $o.lastKeyword&&(b+="&wq="+encodeURIComponent($o.lastKeyword)),"string"==typeof $o.pvid&&(b+="&pvid="+$o.pvid)),b.indexOf("/search.taotao.com/")>0)try{JA.tracker.ngloader("search.000009",{key:f,posid:a,target:b})}catch(o){}("undefined"==typeof search.isSubmitted||0==search.isSubmitted)&&(setTimeout(function(){window.location.href=b},50),search.isSubmitted=!0)}var $o=function(a){var b=$("#key");if(!(b.length<1)){var c={};c.replace=function(a,b){return a.replace(/#{(.*?)}/g,function(){var a=arguments[1];return"undefined"!=typeof b[a]?b[a]:arguments[0]})},c.genPvid=function(){var a=(new Date).getTime();var b="xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(b){var c=(a+16*Math.random())%16|0;return a=Math.floor(a/16),("x"==b?c:3&c|8).toString(16)});return b},c.getQueryString=function(b,c){var d=new RegExp("(^|\\?|&)"+b+"=([^&]*)(\\s|&|$)","i");var e=c?c:a.location.search;return d.test(e)?RegExp.$2:""},c.htmlspecialchars=function(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;"):""},c.htmlspecialcharsDecode=function(a){return"string"==typeof a?a.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"'):""},String.prototype.isEmpty=function(){return 0==this.length},c.textSelect=function(a,b,c){if("string"==typeof a&&(a=document.getElementById(a)),a){var d=1*b,e=1*c,f=a.value.length;if(f)if(d||(d=0),e||(e=f),d>f&&(d=f),0>d&&(d=f+d),0>e&&(e=f+e),a.createTextRange){var g=a.createTextRange();g.moveStart("character",-f),g.moveEnd("character",-f),g.moveStart("character",d),g.moveEnd("character",e),g.select()}else a.setSelectionRange(d,e),a.focus()}},c.getSelectText=function(a){return document.selection?document.selection.createRange().text:a?a.value.substring(a.selectionStart,a.selectionEnd):""};var d='<a style="color:#005AA0" onclick="$o.del(event)">\u5220\u9664</a>';var e="\u641c\u7d22\u5386\u53f2",f="\u7ea6#{amount}\u4e2a\u5546\u54c1",g='history="1"',h='style="color:#005AA0"';var i='<li id="d_#{id}" suggest-pos="#{suggest_pos}" title="#{title}" onclick="$o.clickItem(this)" #{history_mark}><div class="search-item" #{history_style}>#{keyword}</div><div class="search-count">#{search_count}</div></li>';var j='<li class="brand-search"><div id="d_#{id}" class="info J_shop_box" style="cursor:default;">#{guide}</div>#{categorys}</li>';var k='<li class="fore1"><div id="d_#{id}" suggest-pos="#{suggest_pos}" class="fore1" title="#{title}" onclick="$o.clickItem(this)" #{history_mark}><div class="search-item" #{history_style}>#{keyword}</div><div class="search-count">#{search_count}</div></div>#{categorys}</li>';var l='<div id="d_#{id}" suggest-pos="#{suggest_pos}" class="#{className}" title="#{title}" cid="#{cid}" cLevel="#{cLevel}" onclick="$o.clickItem(this)"><div class="search-item">\u5728<strong>#{cname}</strong>\u5206\u7c7b\u4e2d\u641c\u7d22</div><div class="search-count">\u7ea6#{amount}\u4e2a\u5546\u54c1</div></div>';var n='<div id="d_#{id}" suggest-pos="#{suggest_pos}" class="#{className}" title="#{title}" gp="1" onclick="$o.clickItem(this)"><div class="search-item">\u5728<strong> \u5168\u7403\u8d2d </strong>\u4e2d\u641c\u7d22</div><div class="search-count">\u7ea6#{amount}\u4e2a\u5546\u54c1</div></div>';var o='<div id="d_#{id}" suggest-pos="#{suggest_pos}" class="#{className}" title="#{title}" act="#{act_value}" onclick="$o.clickItem(this)"><div class="search-item">\u5728#{act_name}\u4e2d\u641c\u7d22</div><div class="search-count">\u7ea6#{amount}\u4e2a\u5546\u54c1</div></div>';var p='<div id="d_#{id}" class="bs-item J_shop_box"><a class="logo" href="//mall.taotao.com/index-#{shop_id}.html"><img width="90" height="30" src="#{shop_logo}"/></a><a class="name" href="//mall.taotao.com/index-#{shop_id}.html">#{shop_name}</a></div>';var q=c.genPvid();var r="//dd-search.taotao.com/?ver=2&zip=1&key=#{keyword}&pvid="+q+"&t=#{time}";var s="//hiswd.taotao.com/?pvid="+q;var t="#FFDFC6";var u="#FFF";var v=$("#shelper");var w=null!=navigator.userAgent.toLowerCase().match(/chrome/);r+=function(){var d="&curr_url="+encodeURIComponent(a.location.host+a.location.pathname),e="";if(a.QUERY_KEYWORD&&(d+="&search_key="+encodeURIComponent(a.QUERY_KEYWORD)),a.pageConfig&&a.pageConfig.product&&a.pageConfig.product.cat)e="&cid1="+(a.pageConfig.product.cat[0]||""),e+="&cid2="+(a.pageConfig.product.cat[1]||""),e+="&cid3="+(a.pageConfig.product.cat[2]||"");else if("list.taotao.com"==a.location.host)if(a.pageConfig&&a.pageConfig.queryParam)e="&cid1="+(a.pageConfig.queryParam.c1||""),e+="&cid2="+(a.pageConfig.queryParam.c2||""),e+="&cid3="+(a.pageConfig.queryParam.c3||"");else{var f=decodeURIComponent(c.getQueryString("cat")).split(",");e="&cid1="+(f[0]||""),e="&cid2="+(f[1]||""),e="&cid3="+(f[2]||"")}return d+e}(a.location.href);function x(){this.length=0,this.index=-1,this.iLastModified=0,this.lastKeyword=!1,this.keep_keyword="",this.pvid=q,this.enable_remind=!0,this.IME=!1}x.prototype.init=function(){this.length=0,this.index=-1,this.version=0,search.additinal=""},x.prototype.hideTip=function(){this.init(),this.lastKeyword=!1;var a=c.getSelectText(b[0]);this.keep_keyword&&a&&this.keep_keyword+a==b.val()&&b.val(this.keep_keyword),v.html("").hide()},x.prototype.clickItem=function(a){var d=a.getAttribute("cid"),e="&suggest="+a.getAttribute("suggest-pos")+"."+this.version;search.cid=null!=d&&""!=d?d:null;var f=a.getAttribute("cLevel");search.cLevel=null!=f&&""!=f?f:null;var g=a.getAttribute("title");null==g||$.trim(g).isEmpty()||b.val(c.htmlspecialcharsDecode(g)),null!==a.getAttribute("pm_type")&&(e+="&prom_type=0"),null!==a.getAttribute("gp")&&(e+="&gp=1"),null!==a.getAttribute("act")&&(e+=a.getAttribute("act")),search.additinal=e,search("key")},x.prototype.mouseenter=function(a){var a=$(a);a.attr("history")&&a.find(".search-count").html(d),a.hasClass("J_shop_box")?a.find(".name").css("text-decoration","underline"):a.css("background",t);var b=a.attr("id").split("_"),c=parseInt(b[1],10);if(c!=this.index){if(this.index>-1){var f=$("#d_"+this.index);f.css("background",u),f.attr("history")&&f.find(".search-count").html(e),f.hasClass("J_shop_box")&&f.find(".name").css("text-decoration","none")}this.index=c}},x.prototype.mouseleave=function(a){a.css("background",u),a.attr("history")&&a.find(".search-count").html(e)},x.prototype.selectItemNode=function(a){var f=this,g=$("#d_"+f.index+":visible");g.css("background-color",u),g.attr("history")&&g.find(".search-count").html(e),g.hasClass("J_shop_box")&&g.find(".name").css("text-decoration","none"),-1==f.index&&-1==a&&(a=0),f.index=(f.length+f.index+a)%f.length;var h=$("#d_"+f.index),i="&suggest="+h.attr("suggest-pos")+"."+f.version;if(h.length>0){h.attr("history")&&h.find(".search-count").html(d),h.hasClass("J_shop_box")?h.find(".name").css("text-decoration","underline"):h.css("background-color",t);var j=h.attr("title");null==j||$.trim(j).isEmpty()||b.val(c.htmlspecialcharsDecode(j));var k=h.attr("cid");search.cid=null!=k&&""!=k?k:null;var l=h.attr("cLevel");search.cLevel=null!=l&&""!=l?l:null,"undefined"!=typeof h.attr("pm_type")&&(i+="&prom_type=0"),"undefined"!=typeof h.attr("gp")&&(i+="&gp=1"),"undefined"!=typeof h.attr("act")&&(i+=h.attr("act")),search.additinal=i}},x.prototype.input=function(){var a=this;a.timeoutId&&clearTimeout(a.timeoutId),a.timeoutId=setTimeout(function(){var d=$.trim(b.val());return d===a.lastKeyword?!1:(a.lastKeyword=d,void $.ajax({url:d?c.replace(r,{keyword:encodeURIComponent(d),time:(new Date).getTime()}):s,dataType:"jsonp",scriptCharset:"utf-8",jsonp:"callback",cache:!0,success:function(b){return function(c){a.iLastModified>b||(a.iLastModified=b,a.onloadItems(c))}}((new Date).getTime())}))},150)},x.prototype.keydown_up=function(c){var d=this;var e=c||a.event;0==b.length&&(b=$("#key")),0==v.length&&(v=$("tie"));var f=e.keyCode;switch(f){case 38:d.selectItemNode(-1);break;case 40:d.selectItemNode(1);break;case 27:d.hideTip();break;case 37:break;case 39:break;default:d.IME=229==f,8==f||46==f?d.disableRemind():d.enable_remind=!0,$.browser.mozilla||d.input()}},x.prototype.onloadItems=function(d){if(!d||!d.length)return this.hideTip(),!1;this.init();var q=this,r=a.pageConfig&&a.pageConfig.searchType?a.pageConfig.searchType:0,s=1,t=sCategoriesHtml="",u=iLen=iItemLen=0,w=d.length,x=c.htmlspecialchars(b.val());for(d[w-1]&&d[w-1].version&&(q.version=d[w-1].version);w>u;u++){var y=d[u];if(y.rem&&q.remindKey(y.rem.rei,y.rem.req),!(!y||!y.key&&!y.sho||y.sho&&0!=iItemLen||y.key==x&&0!=iItemLen)){var z=c.htmlspecialchars(y.key),A=y.his?e:c.replace(f,{amount:y.qre}),B=y.his?g:"",C=y.his?h:"",D=z.indexOf(x),E=z;if(x.length&&0==D&&!y.his&&(E=x+"<strong>"+z.substring(D+x.length)+"</strong>"),0==iItemLen){if(y.sho){if("object"==typeof y.sho&&y.sho.length&&y.sho[0].sid){var F=y.sho[0];sCategoriesHtml+=c.replace(p,{id:++iLen,shop_id:F.sid,shop_name:F.sna,shop_logo:"//img30.360buyimg.com/n1/s90x30_"+F.spi}),t+=c.replace(j,{id:0,guide:F.ssq,categorys:sCategoriesHtml}),iItemLen++}continue}if((0==r||1==r)&&(y.acq&&y.acu&&(sCategoriesHtml+=c.replace(o,{id:++iLen,title:z,className:"item1",act_name:y.acp?'<img src="//img11.360buyimg.com/img/'+y.acp+'">':"<strong> "+y.acq+" </strong>",act_value:y.acu,amount:y.acc,suggest_pos:s+".acq.0"})),y.wor&&(sCategoriesHtml+=c.replace(n,{id:++iLen,title:z,className:"item1",amount:y.wor,suggest_pos:s+".wor.0"}))),y.ci&&y.ci.length>0)for(var G=0,H=y.ci.length;H>G;G++){var I=y.ci[G].cid;if(0==r){if("string"==typeof I&&/^[1-8]4$/.test(I))continue}else if(5==r){if("string"==typeof I&&!/^[5-8]2$/.test(I))continue}else if(1==r||2==r||3==r||4==r)continue;sCategoriesHtml+=c.replace(l,{id:++iLen,title:z,cid:I,cLevel:y.ci[G].cle,className:"item1",cname:y.ci[G].cna,amount:y.ci[G].cre,suggest_pos:s+".cid."+(G+1)})}0==iLen&&(iLen=-1)}t+=0==iItemLen&&iLen>0?c.replace(k,{id:0,title:z,keyword:E,suggest_pos:s++ +(y.his?".his.0":".def.0"),categorys:sCategoriesHtml,search_count:A,history_mark:B,history_style:C}):c.replace(i,{id:++iLen,title:z,keyword:E,suggest_pos:s++ +(y.his?".his.0":".def.0"),search_count:A,history_mark:B,history_style:C}),iItemLen++}}q.length=++iLen,""!=t?(t+="object"==typeof y&&y.his?'<li class="close" onclick="$o.del(event)">\u5168\u90e8\u5220\u9664</li>':'<li class="close" onclick="$o.hideTip()">\u5173\u95ed</li>',v.html(t).show().find('[id^="d_"]').bind("mouseleave",function(){q.mouseleave($(this))}).bind("mouseenter",function(){q.mouseenter($(this))})):v.html("").hide()},x.prototype.disableRemind=function(){search.additinal="&suggest=1.rem.0."+this.version,this.enable_remind=!1},x.prototype.remindKey=function(a,d){b.val()==a&&this.enable_remind&&(w&&this.IME&&/\w/.test(a.substr(-1))||(b.val(d),this.keep_keyword=a,search.additinal="&suggest=1.rem.1."+this.version,c.textSelect("key",a.length)))},x.prototype.bind_input=function(){$.browser.mozilla?(b.bind("keydown",function(a){y.keydown_up(a)}),b.bind("input",function(a){y.input(a)})):b.bind("keydown",function(a){y.keydown_up(a)}),b.focus(function(){setTimeout(function(){y.input()},10)}),v.parent().bind("mouseenter",function(){y.e_position=!0,y.timeoutId&&clearTimeout(y.timeoutId)}).bind("mouseleave",function(){y.e_position=!1,y.timeoutId=setTimeout(function(){y.hideTip()},500)}),$(document).click(function(){y.e_position||(y.hideTip(),y.uploader.clear())})},x.prototype.del=function(b){var c=this;b=b?b:a.event,a.event?(b.cancelBubble=!0,b.returnValue=!1):(b.stopPropagation(),b.preventDefault());var d=$(b.srcElement?b.srcElement:b.target),e=d.parent().parent().attr("title");$.ajax({url:s+(void 0==e?"&delall=1":"&del="+encodeURIComponent(e)),dataType:"jsonp",scriptCharset:"utf-8",success:function(a){c.onloadItems(a)}})},x.prototype.uploader={init:function(){var c=this;switch(a.location.host){case"search.taotao.com":case"www.taotao.com":break;default:return!1}b.bind("click",function(){c.clear()}).after('<span class="photo-search-btn"><form id="search-img-upload" clstag="h|keycount|2016|03d" method="post" action="//search.taotao.com/image?op=upload" enctype="multipart/form-data" target="search_upload"><span class="upload-bg"></span><input type="file" name="file" class="upload-trigger" accept="image/png,image/jpeg,image/jpg"></form></span>'),$("#search-img-upload").find("input").click(function(){y.hideTip(),c.clear()}).change(function(){c.msg("\u56fe\u7247\u4e0a\u4f20\u4e2d\uff0c\u5927\u6279\u76f8\u4f3c\u5546\u54c1\u6b63\u5728\u8d76\u6765\uff0c\u8bf7\u7a0d\u7b49......"),c.old_domain=document.domain,document.domain="taotao.com",$("body").append('<iframe id="J_image_upload" name="search_upload" style="display:none;"></iframe>'),$("#J_image_upload").load(function(){!c.is_callback&&c.msg("\u62b1\u6b49\uff0c\u56fe\u7247\u4e0a\u4f20\u5931\u8d25","\u7f51\u7edc\u72b6\u51b5\u4e0d\u597d\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u8bd5\u8bd5~")});try{JA.tracker.ngloader("search.000013",{url:a.location.href})}catch(b){}$("#search-img-upload").submit()})},msg:function(a,b){var c=$("#photo-search-dropdown");c=c.length?c:$('<div id="photo-search-dropdown"><div class="photo-search-tip"><div class="tip-inner tip-error"><i class="tip-icon"></i><div class="tip-main"><h5 class="tip-title"></h5><div class="tip-hint"></div></div></div></div></div>').insertAfter("#shelper");var d=c.find(".tip-inner");b?d.addClass("tip-error").find(".tip-title").show().html(a).next().html(b):d.removeClass("tip-error").find(".tip-title").hide().next().html(a)},callback:function(b){if(this.is_callback=1,"ERROR"==b.split(".")[0])switch(b.split(".")[1]){case"UPLOAD_RETRY":this.msg("\u62b1\u6b49\uff0c\u56fe\u7247\u4e0a\u4f20\u5931\u8d25","\u7f51\u7edc\u72b6\u51b5\u4e0d\u597d\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u8bd5\u8bd5~");break;case"UPLOAD_SIZE":this.msg("\u62b1\u6b49\uff0c\u56fe\u7247\u4e0a\u4f20\u5931\u8d25","\u56fe\u7247\u4e0d\u80fd\u5927\u4e8e4M\uff0c\u8bf7\u6362\u4e00\u5f20\u56fe\u8bd5\u8bd5~");break;case"UPLOAD_MIN_WH":this.msg("\u62b1\u6b49\uff0c\u56fe\u7247\u4e0a\u4f20\u5931\u8d25","\u56fe\u7247\u5c3a\u5bf8\u4e0d\u80fd\u5c0f\u4e8e201x201 px");break;case"UPLOAD_FORMAT":this.msg("\u62b1\u6b49\uff0c\u56fe\u7247\u4e0a\u4f20\u5931\u8d25","\u53ea\u652f\u6301jpg\u6216png\u683c\u5f0f\u7684\u56fe\u7247");break;case"UPLOAD_JSF":this.msg("\u62b1\u6b49\uff0c\u56fe\u7247\u4e0a\u4f20\u5931\u8d25","\u7f51\u7edc\u72b6\u51b5\u4e0d\u597d\uff0c\u8bf7\u91cd\u65b0\u4e0a\u4f20\u8bd5\u8bd5~");break;default:this.clear()}else a.location.href="//search.taotao.com/image?path="+encodeURIComponent(b)+"&op=search"},clear:function(){this.old_domain&&(document.domain=this.old_domain),this.is_callback=0,$("#J_image_upload").remove(),$("#photo-search-dropdown").remove()}};var y=new x;return y.bind_input(),y.uploader.init(),y}}(window);

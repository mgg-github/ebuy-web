define("home/widget/head_myjd",function(require,exports,module){"use strict";function t(){e.init()}var a=require("conf"),n=require("load_async"),i=require("jdf/1.0.0/unit/login/3.0.0/login.js"),e=(require("jdf/1.0.0/ui/dropdown/1.0.0/dropdown.js"),require("jdf/1.0.0/unit/globalReco/1.0.0/globalReco.js"),require("jdf/1.0.0/unit/cookie/1.0.0/cookie.js"),{init:function(){var t=$("#ttbar-myjd");t.find(".dd").html('<div class="dd-spacer"></div><div class="dd-inner"><span class="loading"></span></div>'),this.el=t,this.bind()},bind:function(t){var a=this;this.el.dropdown({enterDelay:100,trigger:!0,current:"hover",onchange:function(t){t.attr("data-load")||(t.attr("data-load",1),a.checkLoginInit())}})},checkLoginInit:function(){var t=this;i({automatic:!0,complete:function(a){if(a){var n;n=t.tpl(),a.Identity.IsAuthenticated&&t.hasLoginInit(),t.el.find(".dd").html(n),t.baitiaoInit()}}})},tpl:function(){return'<div class="dd-spacer"></div>\t\t\t\t<div class="myjdlist">\t\t\t\t\t<div class="fore1">\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//order.taotao.com/center/list.action" clstag="" target="_blank">待处理订单<span id="num-unfinishedorder"></span></a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//myjd.taotao.com/afs/indexNew.action?entry=1" clstag="" target="_blank">返修退换货</a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//t.taotao.com/product/followProductList.action?isReduce=true" clstag="" target="_blank">降价商品<span id="num-reduction"></span></a>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t\t<div class="fore2">\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//joycenter.taotao.com/msgCenter/queryHistoryMessage.action" target="_blank">消息<span id="num-tip"></span></a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="http://question.taotao.com/myjd/getMyjdAnswerList.action" clstag="" target="_blank">我的问答<span id="num-consultation"></span></a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//t.taotao.com/home/follow" clstag="" target="_blank">我的关注</a>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div class="myjdlist myjdlist_2">\t\t\t\t\t<div class="fore1">\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//bean.taotao.com/myJingBean/list" clstag="" target="_blank">我的京豆</a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="item baitiao">\t\t\t\t\t\t\t<a href="//baitiao.taotao.com/" clstag="jr|keycount|njdhome|wdbaitiao" target="_blank">我的白条</a>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t\t<div class="fore2">\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//quan.taotao.com/user_quan.action" target="_blank">我的优惠券<span id="num-ticket"></span></a>\t\t\t\t\t\t</div>\t\t\t\t\t\t<div class="item">\t\t\t\t\t\t\t<a href="//trade.jr.taotao.com/centre/browse.action" clstag="" target="_blank">我的理财</a>\t\t\t\t\t\t</div>\t\t\t\t\t</div>\t\t\t\t</div>\t\t\t\t<div class="viewlist" style="display:none;">\t\t\t\t\t<div class="smt">\t\t\t\t\t\t<h4>我的足迹</h4>\t\t\t\t\t\t<span class="extra">\t\t\t\t\t\t\t<a target="_blank" href="//my.taotao.com/history/list.html">更多&nbsp;&gt;</a>\t\t\t\t\t\t</span>\t\t\t\t\t</div>\t\t\t\t\t<div class="smc"></div>\t\t\t\t</div>'},hasLoginInit:function(){var t=this;n({url:a.INTERFACE.MYJD_GETHOMECOUNT,dataType:"jsonp",jsonpCallback:"jsonpCallbackMyJDHomeCount"}).then(function(a){a&&0==a.error&&t.el.find("#num-unfinishedorder").html(t.numStyleSet(a.orderCount))}),n({url:a.INTERFACE.MYJD_GETMYJDANSWERCOUNT,dataType:"jsonp",jsonpCallback:"jsonpCallbackMyJDAnswerCount"}).then(function(a){var n=a.data;n.success&&t.el.find("#num-consultation").html(t.numStyleSet(n.result.answerCount))}),n({url:a.INTERFACE.MYJD_REDUCEPRODUCTCOUNT,dataType:"jsonp",jsonpCallback:"jsonpCallbackMyJDReduceProduct"}).then(function(a){a&&a.data>0&&t.el.find("#num-reduction").html(t.numStyleSet(a.data))}),n({url:a.INTERFACE.MYJD_GETCOUPONCOUNT,dataType:"jsonp",jsonpCallback:"jsonpCallbackMyJDGetCouponCount"}).then(function(a){a&&a.CouponCount&&t.el.find("#num-ticket").html(t.numStyleSet(a.CouponCount))}),n({url:a.INTERFACE.MYJD_MSGCENTER,dataType:"jsonp",jsonpCallback:"jsonpCallbackMyJDMsgCenter"}).then(function(a){a&&"G001001"==a.result&&t.el.find("#num-tip").html(t.numStyleSet(a.msgUnreadCount))})},numStyleSet:function(t){return 0==t?"":'<span class="num style-red">&nbsp;'+t+"</span>"},baitiaoInit:function(t){var a=this;pageConfig.user.pin?this.baitiaoLinkSet(function(t){var n=a.el.find(".baitiao");t.btName&&t.btUrl&&n.html('<a href="'+t.btUrl+'" target="_blank">'+t.btName+"</a>")}):a.el.find(".baitiao").show()},baitiaoLinkSet:function(t){n({url:a.INTERFACE.MYJD_QUERYBT,dataType:"jsonp",scriptCharset:"utf-8",jsonpCallback:"jsonpCallbackMyJDBt"}).then(function(a){a&&a.btList&&a.btList[0]&&t(a.btList[0])})}});return t});
define("home/widget/top",["O2_COMPONENT/tab/1.0.0/tab.js"],function(require,exports,module){"use strict";var t=require("conf"),a=require("load_async"),r=_.Class.extend({construct:function(t){this.conf=$.extend({$el:null},t),this.conf.$el&&(this.supportTransform=o2.detect.css3test("transform"),this.loadErr=[],this.$tabContainer=$(".J_top_tab",this.conf.$el),this.$tabContainer.find(".J_tab_head").length&&this.initTab())},initTab:function(){var t=(this.conf.$el,require("O2_COMPONENT/tab/1.0.0/tab.js"));new t({container:this.$tabContainer,startAt:0,hash:!1,activeClass:"top_tab_head_item_on",hoverToSwitch:!0,onAfterSwitch:$.proxy(function(t){var a=this.$tabContainer.find(".J_top_tab_active"),r=78*t;this.supportTransform?a.css({transform:"translateX("+r+"px)","-webkit-transform":"translateX("+r+"px)","-moz-transform":"translateX("+r+"px)","-ms-transform":"translateX("+r+"px)"}):a.css("left",r+"px"),$.inArray(t,this.loadErr)>=0&&this.loadTop(t)},this),onFirstShow:$.proxy(this.loadTop,this)})},loadTop:function(r){var i=this,e=this.conf.$el,s=$($(".J_tab_head_item",e).get(r)),o=$($(".J_tab_content_item",e).get(r)).html("").addClass("mod_loading"),l='        {%          var list = o.list;          var topPrefix = pageConfig.clstagPrefix + "16";        %}        <ul class="top_list clearfix">          {% for (j = 0; j < 6; j++) { %}          {% var item = list[j]; %}          <li class="top_item{%= \' top_item_\' + (j + 1) %}">            <a href="{%= item.url %}" target="_blank" class="top_lk" clstag="{%= topPrefix + \'c0'+(1+r)+'0\' + (1 + j) %}">              <div class="top_rank{%= \' top_rank_\' + (j + 1) %}">{%= (j + 1) %}</div>              <div class="top_pic">                <img src="//taotao.com/mtd/pc/common/img/blank.png" data-lazy-img="{%= item.imgUrl %}" alt="{%= item.wareName %}" title="{%= item.wareName %}" class="top_img" >              </div>              <p class="top_name">{%= item.wareName %}</p>            </a>          </li>          {% } %}        </ul>',n=s.data("id"),c=t.INTERFACE.TOP;a({url:c.HOT_SALE,backup:c.HOT_SALE_BACKUP_PC,params:{cateid:n,source:"pc"},jsonpCallback:"jsonpCallbackTopHotsale"+(r+1),timeout:t.TIMEOUT,dataCheck:function(t){if("0"!==t.code||"object"!=typeof t)return!1;var a=t.products;return!!($.isArray(a)&&a.length>=6)}}).then(function(a){var e=$.inArray(r,i.loadErr);if("object"==typeof a&&"0"===a.code){var s=a.products,c=window.pageConfig;if(s&&s.length){e>=0&&i.loadErr.splice(e,1);var m=s.slice(0,6);m=$.map(m,function(a){var r=a.imgPath;/m.taotao.com/.test(a.imgPath)||(r="//m.taotao.com/mobilecms/"+r);var i=a.wareId.match(/(\d)$/)?a.wareId:"11";return r=c.replaceMImageUrl(r,i),a.imgUrl=c.processImageUrl(r,"200x200","100x100"),a.url=t.URLS.TOP+"?cateId="+n+"&itemId="+a.wareId,a});try{var d=require("o2tpl"),p=d(l,{list:m})||"";o.removeClass("mod_loading").html(p),_.eventCenter.trigger("lazyload:DOMUpdate",o)}catch(h){e<0&&i.loadErr.push(r),o.removeClass("mod_loading").html('<div class="errtips"></div>')}}else e<0&&i.loadErr.push(r),o.removeClass("mod_loading").html('<div class="errtips"></div>')}else e<0&&i.loadErr.push(r),o.removeClass("mod_loading").html('<div class="errtips"></div>')},function(){var t=$.inArray(r,i.loadErr);t<0&&i.loadErr.push(r),o.removeClass("mod_loading").html('<div class="errtips"></div>')})}});return r});
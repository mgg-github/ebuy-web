define("home/widget/fbt",function(require){"use strict";var t=require("load_async"),e=require("conf"),a=require("report"),n=_.Class.extend({construct:function(t){this.conf=$.extend({$el:null,domStr:"",next:function(){}},t),this.init()},init:function(){this.data={find:{},brand:{},top:{nav:[]}},this.loadAll()},hideFbt:function(){this.conf.$el.height(0).hide(),a.processHidedFloor(pageConfig.reportFloorHideHash.fbt),_.eventCenter.trigger("render:floorChange","fbt")},loadAll:function(){var t=this,e=t.conf;$.when(this.loadFind(),this.loadBrand(),this.loadTop(),this.loadSup()).then(function(a,n,o,i){if(a&&a.length&&n&&n.length&&n[0].data&&o&&o.length&&i&&i.length){for(var r=n[0].data,d=a[0].list||[],l=d.slice(0,6),c=window.pageConfig,s=i[0].data,p=l.length,u=s.length;p--;){var f=l[p],h=f.goodsPic;h=h.replace(/!q\d+.jpg/,"").replace(/\.JPG/,".jpg"),h=c.replaceMImageUrl(h,f.id),f.goodsPic=c.processImageUrl(h,"160x160","80x80")}for(;u--;)for(var f=s[u],g=f.list,C=g.length;C--;){var h=g[C];h=h.replace(/!q\d+.jpg/,"").replace(/\.JPG/,".jpg"),h=c.replaceMImageUrl(h,3*u+C),g[C]=c.processImageUrl(h,"220x220","110x110")}t.data=r||t.data,t.data.sup=t.data.sup||{},t.data.sup.list=s||[],t.data.find=t.data.find||{},t.data.find.list=l;var b=o[0];if("object"==typeof b&&b.cateList&&b.cateList.length){var T=b.cateList.slice(0,5);t.data.top=t.data.top||{},t.data.top.nav=T}t.renderFbt(t.data)}else e.next&&e.next(),t.hideFbt()},function(){e.next&&e.next(),t.hideFbt()})},renderFbt:function(t){var e=this.conf;try{var a=require("o2tpl"),n=a(e.domStr,t);e.$el.append(n),e.next&&e.next(),this.initSup(),this.initTop()}catch(o){e.next&&e.next(),this.hideFbt(),_.console.log(o)}},loadFind:function(){return t({url:e.INTERFACE.FIND,backup:e.INTERFACE.FIND_BACKUP_PC,jsonpCallback:"jsonpCallbackFindGood",timeout:e.TIMEOUT,dataCheck:function(t){return!!(t&&"0"===t.code&&$.isArray(t.list)&&t.list.length>=6)}})},loadBrand:function(){var a=window,n=e.INTERFACE.BRAND,o="aggr";return t({url:n,needStore:!0,backup:e.DOMAINS.BACKUP_FLOOR+o,storeSign:a.sourceVersion&&a.sourceVersion[o],jsonpCallback:"jsonpCallbackAggr",timeout:e.TIMEOUT,dataCheck:function(t){return!(!t||!t.data||"object"!=typeof t.data.find||"object"!=typeof t.data.top||"object"!=typeof t.data.sup)}})},loadSup:function(){var a=e.INTERFACE.SUP,n=e.INTERFACE.SUP_BACKUP,o=(window,{pin:pageConfig.user.pin,uuid:pageConfig.user.uuid});return t({url:a,backup:n,params:o,jsonpCallback:"jsonpCallbackSup",timeout:e.TIMEOUT,dataCheck:function(t){return!(""!==t.errCode||!$.isArray(t.data)||t.data.length<6)}})},loadTop:function(){var a=e.INTERFACE.TOP;return t({url:a.RANK_LIST,backup:a.RANK_LIST_BACKUP_PC,params:{source:"pc"},jsonpCallback:"jsonpCallbackTopRank",timeout:e.TIMEOUT,dataCheck:function(t){return!!("object"==typeof t&&"0"===t.code&&$.isArray(t.cateList)&&t.cateList.length>=5)}})},initTop:function(){var t=this.conf.$el;seajs.use("home/widget/top",function(e){new e({$el:$(".J_top",t)})})},initSup:function(){var t=this.conf.$el;seajs.use("home/widget/sup",function(e){var a=new e({$el:$(".J_sup",t)});a.init()})}});return n});
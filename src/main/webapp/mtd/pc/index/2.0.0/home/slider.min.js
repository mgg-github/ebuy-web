define("home/widget/slider",["O2_COMPONENT/carousel/1.0.0/carousel.js","O2_COMPONENT/util/1.0.0/util.js"],function(require){"use strict";var e=require("O2_COMPONENT/carousel/1.0.0/carousel.js"),i=require("O2_COMPONENT/util/1.0.0/util.js"),t=require("conf"),a=require("logger"),o=require("load_async"),r=_.Class.extend({construct:function(e){this.conf=$.extend({$el:null},e),this.width=790,this.isWide=pageConfig.compatible&&pageConfig.wideVersion,this.init()},init:function(){this.buildCarouselDom(),this.buildBottom(),this.initEvent()},buildCarouselDom:function(){var e=this,i=[],a=(window,t.INTERFACE.FOCUS),r=pageConfig.useBi?{pin:pageConfig.user.pin,uuid:pageConfig.user.uuid}:{};o({url:a,params:r,needStore:!0,times:0,timeout:1e3,backup:t.DOMAINS.BACKUP_FLOOR+"focus",dataCheck:function(e){if(e.data&&$.isArray(e.data))return!0},jsonpCallback:"jsonpCallbackFocus"}).then(function(t){t.data&&$.isArray(t.data)&&(i=t.data,e.createCarsouelDom(i))})},createCarsouelDom:function(e){var i=this,t="",a="",o=this.conf.$el,r=$(".J_slider_main",o),s=o.find(".J_slider_list");e.splice(6,2,e.pop()),$.each(e,function(e,a){var o,r,s,n=(a.length,String(102+e).substring(1));a=pageConfig.FN_GetRandomData(a),pageConfig.clog.logDomain=pageConfig.clog.logDomain||a.logDomain,pageConfig.clog.logV=pageConfig.clog.logV||a.logV,o=i.isWide?a.src:a.srcB,a.clog?r='            <li class="J_slider_item slider_item">              <a href="'+a.href+'"                class="slider_item_lk mod_loading J_slider_item_lk"                fclog="'+a.clog+'"                clstag="'+pageConfig.clstagPrefix+"08a"+n+'"                target="_blank">                <img data-lazy-src="'+o+'"                  alt="'+a.alt+'"                  src="//taotao.com/mtd/pc/common/img/blank.png"                  class="J_slider_item_img slider_item_img" /></a>            </li>':(s=pageConfig.generateBiLog(a),r='<li class="J_slider_item slider_item">            <a href="'+a.href+'"              class="slider_item_lk mod_loading J_log"              clstag="'+pageConfig.clstagPrefix+"08a"+n+'"              target="_blank"'+s+'>              <img data-lazy-src="'+o+'"                alt="'+a.alt+'"                src="//taotao.com/mtd/pc/common/img/blank.png"                class="J_slider_item_img slider_item_img" /></a>          </li>'),t+=r}),s.length||(a='<ul class="slider_list J_slider_list">'+t+'</ul>          <div class="J_slider_indicator slider_indicator"></div><a href="javascript:void(0)" clstag="" class="J_slider_control_prev slider_control_item slider_control_prev"><i class="iconfont">&#xe602;</i></a><a href="javascript:void(0)" clstag="" class="J_slider_control_next slider_control_item slider_control_next"><i class="iconfont">&#xe601;</i></a>',r.append(a).removeClass("mod_lazyload")),s.append(t),pageConfig.enableActMark&&$(".J_slider_item_lk",s).append('<i class="mod_actmark mod_actmark_focus"></i>'),this.initCarousel(),this.initCarouselNav(),pageConfig.useBi||this.changeRTB();var n=s.find("[fclog]");n.length&&_.eventCenter.on("home:load",function(){pageConfig.sendClog(n)})},buildBottom:function(){var e=pageConfig.focusBottomData||{data:[]},i=!0,a=this,r=[];$.each(e.data,function(e,t){t.isTop?r.push(e):i=!1}),i?a.createBottomDom(e.data):o({url:t.INTERFACE.FOCUS_BOTTOM_REC,params:{pin:pageConfig.user.pin,uuid:pageConfig.user.uuid},jsonpCallback:"jsonpCallbackFocusBottomRec",times:0,timeout:1e3}).then(function(i){if(i&&i.data&&2!==i.errCode){var t=i.data,o=e.data;t&&t.length?($.each(t,function(e){if($.inArray(e,r)>=0&&o[e]){var i=t[e];t[e]=o[e],t[e+1]&&(t[e+1]=i)}}),t.length<2&&o.length&&t.push(o[0])):t=o,a.createBottomDom(t),_.eventCenter.on("home:load",function(){var e=i.impr;e&&a.monitor(i.impr)})}else a.createBottomDom(e.data);_.eventCenter.on("home:load",function(){a.errorMonitor(i)})},function(i,t){a.createBottomDom(e.data),_.eventCenter.on("home:load",function(){a.errorMonitor(null,t)})})},createBottomDom:function(e){var i="",t=this,a=t.conf.$el;if(e&&e.length)for(var o=0;o<2;o++){var r=e[o],s=r.t.replace(/^http(s?):/,""),n=["b","c"],l="";if(/\/\//.test(r.img))l=r.img;else{var c=String(r.sku).match(/(\d)$/)?r.sku:"11";l=pageConfig.FN_GetImageDomain(c)+r.img}l=pageConfig.processImageUrl(l,"780x260","390x130"),/\!q/.test(l)||(l+="!q90"),i+='<div class="J_slider_bi slider_bi" clstag="'+pageConfig.clstagPrefix+"08"+n[o]+'" data-clk="'+r.clk+'" data-sku="'+r.sku+'">            <a href="'+s+'" class="slider_bi_lk mod_loading" target="_blank">              <img data-lazy-src="'+l+'" class="J_slider_bi_img slider_bi_img" title="" alt="" src="//taotao.com/lib/img/e/blank.gif" >            </a>          </div>'}$(".J_slider_extend",a).append(i).removeClass("mod_lazyload").find(".J_slider_bi_img").each(function(){var e=$(this);t.loadImage(e)})},monitor:function(e){if(e){var i=new Image;i.src=e+"&m=UA-J2011-1&ref="+encodeURIComponent(document.referrer)+"&random="+Math.random(),i=null}},errorMonitor:function(e,i){var a=t.INTERFACE.FOCUS_BOTTOM_REC_ERR_LOG;e?e.data&&e.data.length||this.monitor(a+"2"):"timeout"===i?this.monitor(a+"3"):this.monitor(a+"4")},initCarousel:function(){var i=this.conf.$el,t=i.find(".slider_list"),o=t.children().length;this.carousel=new e({container:t,itemSelector:".slider_item",activeClass:"slider_item_active",startIndex:0,duration:300,delay:3e3,zIndex:1,switchType:"fade",onFirstSwitch:$.proxy(function(e){var i=$(".J_slider_item",t).eq(e),r=$(".J_slider_item_img",i),s=e+1;s===o&&(s=0);var n=$(".J_slider_item",t).eq(s).find(".J_slider_item_img");a.logArea(i),this.loadImage(r),this.loadImage(n)},this),onBeforeSwitch:$.proxy(function(e,i){var t=$(".slider_indicator_btn",this.conf.$el).eq(i);t.siblings().removeClass("slider_indicator_btn_active").end().addClass("slider_indicator_btn_active")},this)})},loadImage:function(e){if(e.length){var i=e.data("lazy-src");i&&i.length&&e.attr("src",i).one("load",function(){$(this).removeAttr("data-lazy-src").parent().removeClass("mod_loading")}).each(function(){this.complete&&$(this).load()})}},initEvent:function(){var e=this;this.conf.$el.delegate(".slider_indicator_btn","mouseenter",i.throttle(function(){var i=e.carousel,t=$(this).index();i.stop(),t!==i.getCurrent()&&($(this).siblings().removeClass("slider_indicator_btn_active").end().addClass("slider_indicator_btn_active"),i.switchTo(t))},500)).delegate(".J_slider_bottom_btn[data-clk]","click",function(){var i=$(this);e.monitor(i.data("clk"))}).delegate(".J_slider_control_prev","click",$.proxy(this.prevCarousel,this)).delegate(".J_slider_control_prev","mouseenter",function(){var i=e.carousel;i.stop(),e.restartCarousel()}).delegate(".J_slider_control_next","click",$.proxy(this.nextCarousel,this)).delegate(".J_slider_control_next","mouseenter",function(){var i=e.carousel;i.stop(),e.restartCarousel()})},changeRTB:function(){var e=2382;pageConfig.wideVersion||(e=2433);var i=$(".J_slider_main .J_slider_item",this.conf.$el),t=i.eq(i.length-1);if(!t.length)return!1;var a=this;$.getJSON("//x.taotao.com/focus?spread_type=1&ad_type=10&template=0&ad_ids="+e+":1&callback=?",function(o){if(o&&$.isArray(o[e])&&o[e].length){var r=o[e][0];$("a:eq(0)",t).attr("href",r.click_url.replace(/^http(s?):/,"")),r.image_url="//img13.360buyimg.com/da/"+r.image_url;var s=$("a:eq(0) img",t);a.carousel.getCurrent()===i.length-1?s.removeAttr("data-lazy-src").attr("src",r.image_url):s.attr("data-lazy-src",r.image_url).attr("src","//taotao.com/mtd/pc/common/img/blank.png"),function(){var e=!1;$(window).bind("load",function(){e||(e=!0,(new Image).src=r.exposal_url)})}()}})},prevCarousel:function(e){e&&e.preventDefault(),this.carousel.stop().switchToPrev(),this.restartCarousel()},nextCarousel:function(e){e&&e.preventDefault();this.carousel;this.carousel.stop().switchToNext(),this.restartCarousel()},restartCarousel:function(){var e=this.carousel;clearTimeout(this.restartTimer),this.restartTimer=setTimeout(function(){e.start()},4e3)},initCarouselNav:function(){for(var e=this.carousel.length,i=[],t=0;t<e;t++){var a=null,o="";t===e-1?a="slider_indicator_btn_last":0===t&&(a="slider_indicator_btn_active"),a="string"==typeof a?" "+a:"",o='<i class="slider_indicator_btn'+a+'"></i>',i.push(o)}var r=this.conf.$el.find(".J_slider_indicator");r.html(i.join("")).css("marginLeft",-r.outerWidth()/2+"px").show()}});return r});